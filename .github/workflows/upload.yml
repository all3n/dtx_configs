name: Upload Files to S3

on:
  push:
    branches:
      - main
      - master
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  upload:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check AWS CLI version
      run: aws --version
      
    - name: Configure AWS CLI for R2
      run: |
        # 手动配置 AWS CLI 用于 R2
        aws configure set aws_access_key_id ${{ secrets.AWS_ACCESS_KEY_ID }} --profile r2
        aws configure set aws_secret_access_key ${{ secrets.AWS_SECRET_ACCESS_KEY }} --profile r2
        aws configure set region us-east-1 --profile r2
        
    - name: Make script executable
      run: chmod +x resources/upload.sh
      
    - name: Run upload script
      run: |
        cd ./resources
        bash ./upload.sh
      env:
        R2_ACCOUNT_ID: ${{ secrets.R2_ACCOUNT_ID }}
